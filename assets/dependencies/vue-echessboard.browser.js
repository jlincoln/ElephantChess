!function(root,factory){"object"==typeof exports&&"object"==typeof module?module.exports=factory():"function"==typeof define&&define.amd?define([],factory):"object"==typeof exports?exports.VueEchessboard=factory():root.VueEchessboard=factory()}(this,function(){return function(modules){function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}var installedModules={};return __webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.i=function(value){return value},__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{configurable:!1,enumerable:!0,get:getter})},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function(){return module.default}:function(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=22)}([function(module,exports,__webpack_require__){"use strict";function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}function memo(f){var v=void 0,ret=function(){return void 0===v&&(v=f()),v};return ret.clear=function(){v=void 0},ret}function computeSquareCenter(key,asWhite,bounds){var pos=exports.key2pos(key);return asWhite||(pos[0]=7-pos[0],pos[1]=7-pos[1]),[bounds.left+bounds.width*pos[0]/8+bounds.width/16,bounds.top+bounds.height*(7-pos[1])/8+bounds.height/16]}var _Array$prototype;Object.defineProperty(exports,"__esModule",{value:!0}),exports.computeSquareCenter=exports.createEl=exports.isRightButton=exports.eventPosition=exports.setVisible=exports.translateRel=exports.translateAbs=exports.posToTranslateRel=exports.posToTranslateAbs=exports.samePiece=exports.distanceSq=exports.opposite=exports.timer=exports.memo=exports.allPos=exports.key2pos=exports.pos2key=exports.allKeys=exports.invRanks=void 0;var cg=__webpack_require__(4);exports.invRanks=[].concat(_toConsumableArray(cg.ranks)).reverse(),exports.allKeys=(_Array$prototype=Array.prototype).concat.apply(_Array$prototype,_toConsumableArray(cg.files.map(function(c){return cg.ranks.map(function(r){return c+r})}))),exports.pos2key=function(pos){return exports.allKeys[8*pos[0]+pos[1]]},exports.key2pos=function(k){return[k.charCodeAt(0)-97,k.charCodeAt(1)-49]},exports.allPos=exports.allKeys.map(exports.key2pos),exports.memo=memo,exports.timer=function(){var startAt=void 0;return{start:function(){startAt=performance.now()},cancel:function(){startAt=void 0},stop:function(){if(!startAt)return 0;var time=performance.now()-startAt;return startAt=void 0,time}}},exports.opposite=function(c){return"white"===c?"black":"white"},exports.distanceSq=function(pos1,pos2){var dx=pos1[0]-pos2[0],dy=pos1[1]-pos2[1];return dx*dx+dy*dy},exports.samePiece=function(p1,p2){return p1.role===p2.role&&p1.color===p2.color};var posToTranslateBase=function(pos,asWhite,xFactor,yFactor){return[(asWhite?pos[0]:7-pos[0])*xFactor,(asWhite?7-pos[1]:pos[1])*yFactor]};exports.posToTranslateAbs=function(bounds){var xFactor=bounds.width/8,yFactor=bounds.height/8;return function(pos,asWhite){return posToTranslateBase(pos,asWhite,xFactor,yFactor)}},exports.posToTranslateRel=function(pos,asWhite){return posToTranslateBase(pos,asWhite,100,100)},exports.translateAbs=function(el,pos){el.style.transform="translate("+pos[0]+"px,"+pos[1]+"px)"},exports.translateRel=function(el,percents){el.style.transform="translate("+percents[0]+"%,"+percents[1]+"%)"},exports.setVisible=function(el,v){el.style.visibility=v?"visible":"hidden"},exports.eventPosition=function(e){var _a;return e.clientX||0===e.clientX?[e.clientX,e.clientY]:(null===(_a=e.targetTouches)||void 0===_a?void 0:_a[0])?[e.targetTouches[0].clientX,e.targetTouches[0].clientY]:void 0},exports.isRightButton=function(e){return 2===e.buttons||2===e.button},exports.createEl=function(tagName,className){var el=document.createElement(tagName);return className&&(el.className=className),el},exports.computeSquareCenter=computeSquareCenter},function(module,exports,__webpack_require__){"use strict";function callUserFunction(f){for(var _len=arguments.length,args=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)args[_key-1]=arguments[_key];f&&setTimeout(function(){return f.apply(void 0,args)},1)}function toggleOrientation(state){state.orientation=util_1.opposite(state.orientation),state.animation.current=state.draggable.current=state.selected=void 0}function reset(state){state.lastMove=void 0,unselect(state),unsetPremove(state),unsetPredrop(state)}function setPieces(state,pieces){var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=pieces[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var _step$value=_slicedToArray(_step.value,2),key=_step$value[0],piece=_step$value[1];piece?state.pieces.set(key,piece):state.pieces.delete(key)}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}}function setCheck(state,color){if(state.check=void 0,!0===color&&(color=state.turnColor),color){var _iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=state.pieces[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var _step2$value=_slicedToArray(_step2.value,2),_k=_step2$value[0],_p=_step2$value[1];"king"===_p.role&&_p.color===color&&(state.check=_k)}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2.return&&_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}}}function setPremove(state,orig,dest,meta){unsetPredrop(state),state.premovable.current=[orig,dest],callUserFunction(state.premovable.events.set,orig,dest,meta)}function unsetPremove(state){state.premovable.current&&(state.premovable.current=void 0,callUserFunction(state.premovable.events.unset))}function setPredrop(state,role,key){unsetPremove(state),state.predroppable.current={role:role,key:key},callUserFunction(state.predroppable.events.set,role,key)}function unsetPredrop(state){var pd=state.predroppable;pd.current&&(pd.current=void 0,callUserFunction(pd.events.unset))}function tryAutoCastle(state,orig,dest){if(!state.autoCastle)return!1;var king=state.pieces.get(orig);if(!king||"king"!==king.role)return!1;var origPos=util_1.key2pos(orig),destPos=util_1.key2pos(dest);if(0!==origPos[1]&&7!==origPos[1]||origPos[1]!==destPos[1])return!1;4!==origPos[0]||state.pieces.has(dest)||(6===destPos[0]?dest=util_1.pos2key([7,destPos[1]]):2===destPos[0]&&(dest=util_1.pos2key([0,destPos[1]])));var rook=state.pieces.get(dest);return!(!rook||rook.color!==king.color||"rook"!==rook.role)&&(state.pieces.delete(orig),state.pieces.delete(dest),origPos[0]<destPos[0]?(state.pieces.set(util_1.pos2key([6,destPos[1]]),king),state.pieces.set(util_1.pos2key([5,destPos[1]]),rook)):(state.pieces.set(util_1.pos2key([2,destPos[1]]),king),state.pieces.set(util_1.pos2key([3,destPos[1]]),rook)),!0)}function baseMove(state,orig,dest){var origPiece=state.pieces.get(orig),destPiece=state.pieces.get(dest);if(orig===dest||!origPiece)return!1;var captured=destPiece&&destPiece.color!==origPiece.color?destPiece:void 0;return dest===state.selected&&unselect(state),callUserFunction(state.events.move,orig,dest,captured),tryAutoCastle(state,orig,dest)||(state.pieces.set(dest,origPiece),state.pieces.delete(orig)),state.lastMove=[orig,dest],state.check=void 0,callUserFunction(state.events.change),captured||!0}function baseNewPiece(state,piece,key,force){if(state.pieces.has(key)){if(!force)return!1;state.pieces.delete(key)}return callUserFunction(state.events.dropNewPiece,piece,key),state.pieces.set(key,piece),state.lastMove=[key],state.check=void 0,callUserFunction(state.events.change),state.movable.dests=void 0,state.turnColor=util_1.opposite(state.turnColor),!0}function baseUserMove(state,orig,dest){var result=baseMove(state,orig,dest);return result&&(state.movable.dests=void 0,state.turnColor=util_1.opposite(state.turnColor),state.animation.current=void 0),result}function userMove(state,orig,dest){if(canMove(state,orig,dest)){var result=baseUserMove(state,orig,dest);if(result){var holdTime=state.hold.stop();unselect(state);var metadata={premove:!1,ctrlKey:state.stats.ctrlKey,holdTime:holdTime};return!0!==result&&(metadata.captured=result),callUserFunction(state.movable.events.after,orig,dest,metadata),!0}}else if(canPremove(state,orig,dest))return setPremove(state,orig,dest,{ctrlKey:state.stats.ctrlKey}),unselect(state),!0;return unselect(state),!1}function dropNewPiece(state,orig,dest,force){var piece=state.pieces.get(orig);piece&&(canDrop(state,orig,dest)||force)?(state.pieces.delete(orig),baseNewPiece(state,piece,dest,force),callUserFunction(state.movable.events.afterNewPiece,piece.role,dest,{predrop:!1})):piece&&canPredrop(state,orig,dest)?setPredrop(state,piece.role,dest):(unsetPremove(state),unsetPredrop(state)),state.pieces.delete(orig),unselect(state)}function selectSquare(state,key,force){if(callUserFunction(state.events.select,key),state.selected){if(state.selected===key&&!state.draggable.enabled)return unselect(state),void state.hold.cancel();if((state.selectable.enabled||force)&&state.selected!==key&&userMove(state,state.selected,key))return void(state.stats.dragged=!1)}(isMovable(state,key)||isPremovable(state,key))&&(setSelected(state,key),state.hold.start())}function setSelected(state,key){state.selected=key,isPremovable(state,key)?state.premovable.dests=premove_1.premove(state.pieces,key,state.premovable.castle):state.premovable.dests=void 0}function unselect(state){state.selected=void 0,state.premovable.dests=void 0,state.hold.cancel()}function isMovable(state,orig){var piece=state.pieces.get(orig);return!!piece&&("both"===state.movable.color||state.movable.color===piece.color&&state.turnColor===piece.color)}function canMove(state,orig,dest){var _a,_b;return orig!==dest&&isMovable(state,orig)&&(state.movable.free||!!(null===(_b=null===(_a=state.movable.dests)||void 0===_a?void 0:_a.get(orig))||void 0===_b?void 0:_b.includes(dest)))}function canDrop(state,orig,dest){var piece=state.pieces.get(orig);return!(!piece||orig!==dest&&state.pieces.has(dest)||"both"!==state.movable.color&&(state.movable.color!==piece.color||state.turnColor!==piece.color))}function isPremovable(state,orig){var piece=state.pieces.get(orig);return!!piece&&state.premovable.enabled&&state.movable.color===piece.color&&state.turnColor!==piece.color}function canPremove(state,orig,dest){return orig!==dest&&isPremovable(state,orig)&&premove_1.premove(state.pieces,orig,state.premovable.castle).includes(dest)}function canPredrop(state,orig,dest){var piece=state.pieces.get(orig),destPiece=state.pieces.get(dest);return!!piece&&(!destPiece||destPiece.color!==state.movable.color)&&state.predroppable.enabled&&("pawn"!==piece.role||"1"!==dest[1]&&"8"!==dest[1])&&state.movable.color===piece.color&&state.turnColor!==piece.color}function isDraggable(state,orig){var piece=state.pieces.get(orig);return!!piece&&state.draggable.enabled&&("both"===state.movable.color||state.movable.color===piece.color&&(state.turnColor===piece.color||state.premovable.enabled))}function playPremove(state){var move=state.premovable.current;if(!move)return!1;var orig=move[0],dest=move[1],success=!1;if(canMove(state,orig,dest)){var result=baseUserMove(state,orig,dest);if(result){var metadata={premove:!0};!0!==result&&(metadata.captured=result),callUserFunction(state.movable.events.after,orig,dest,metadata),success=!0}}return unsetPremove(state),success}function playPredrop(state,validate){var drop=state.predroppable.current,success=!1;if(!drop)return!1;if(validate(drop)){baseNewPiece(state,{role:drop.role,color:state.movable.color},drop.key)&&(callUserFunction(state.movable.events.afterNewPiece,drop.role,drop.key,{predrop:!0}),success=!0)}return unsetPredrop(state),success}function cancelMove(state){unsetPremove(state),unsetPredrop(state),unselect(state)}function stop(state){state.movable.color=state.movable.dests=state.animation.current=void 0,cancelMove(state)}function getKeyAtDomPos(pos,asWhite,bounds){var file=Math.floor(8*(pos[0]-bounds.left)/bounds.width);asWhite||(file=7-file);var rank=7-Math.floor(8*(pos[1]-bounds.top)/bounds.height);return asWhite||(rank=7-rank),file>=0&&file<8&&rank>=0&&rank<8?util_1.pos2key([file,rank]):void 0}function getSnappedKeyAtDomPos(orig,pos,asWhite,bounds){var origPos=util_1.key2pos(orig),validSnapPos=util_1.allPos.filter(function(pos2){return premove_1.queen(origPos[0],origPos[1],pos2[0],pos2[1])||premove_1.knight(origPos[0],origPos[1],pos2[0],pos2[1])}),validSnapCenters=validSnapPos.map(function(pos2){return util_1.computeSquareCenter(util_1.pos2key(pos2),asWhite,bounds)}),validSnapDistances=validSnapCenters.map(function(pos2){return util_1.distanceSq(pos,pos2)}),_validSnapDistances$r=validSnapDistances.reduce(function(a,b,index){return a[0]<b?a:[b,index]},[validSnapDistances[0],0]),_validSnapDistances$r2=_slicedToArray(_validSnapDistances$r,2),closestSnapIndex=_validSnapDistances$r2[1];return util_1.pos2key(validSnapPos[closestSnapIndex])}function whitePov(s){return"white"===s.orientation}var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{!_n&&_i.return&&_i.return()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr))return arr;if(Symbol.iterator in Object(arr))return sliceIterator(arr,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.whitePov=exports.getSnappedKeyAtDomPos=exports.getKeyAtDomPos=exports.stop=exports.cancelMove=exports.playPredrop=exports.playPremove=exports.isDraggable=exports.canMove=exports.unselect=exports.setSelected=exports.selectSquare=exports.dropNewPiece=exports.userMove=exports.baseNewPiece=exports.baseMove=exports.unsetPredrop=exports.unsetPremove=exports.setCheck=exports.setPieces=exports.reset=exports.toggleOrientation=exports.callUserFunction=void 0;var util_1=__webpack_require__(0),premove_1=__webpack_require__(17);exports.callUserFunction=callUserFunction,exports.toggleOrientation=toggleOrientation,exports.reset=reset,exports.setPieces=setPieces,exports.setCheck=setCheck,exports.unsetPremove=unsetPremove,exports.unsetPredrop=unsetPredrop,exports.baseMove=baseMove,exports.baseNewPiece=baseNewPiece,exports.userMove=userMove,exports.dropNewPiece=dropNewPiece,exports.selectSquare=selectSquare,exports.setSelected=setSelected,exports.unselect=unselect,exports.canMove=canMove,exports.isDraggable=isDraggable,exports.playPremove=playPremove,exports.playPredrop=playPredrop,exports.cancelMove=cancelMove,exports.stop=stop,exports.getKeyAtDomPos=getKeyAtDomPos,exports.getSnappedKeyAtDomPos=getSnappedKeyAtDomPos,exports.whitePov=whitePov},function(module,exports,__webpack_require__){"use strict";function start(s,e){if(e.isTrusted&&(void 0===e.button||0===e.button)&&!(e.touches&&e.touches.length>1)){var bounds=s.dom.bounds(),position=util.eventPosition(e),orig=board.getKeyAtDomPos(position,board.whitePov(s),bounds);if(orig){var piece=s.pieces.get(orig),previouslySelected=s.selected;previouslySelected||!s.drawable.enabled||!s.drawable.eraseOnClick&&piece&&piece.color===s.turnColor||draw_1.clear(s),!1===e.cancelable||e.touches&&s.movable.color&&!piece&&!previouslySelected&&!pieceCloseTo(s,position)||e.preventDefault();var hadPremove=!!s.premovable.current,hadPredrop=!!s.predroppable.current;s.stats.ctrlKey=e.ctrlKey,s.selected&&board.canMove(s,s.selected,orig)?anim_1.anim(function(state){return board.selectSquare(state,orig)},s):board.selectSquare(s,orig);var stillSelected=s.selected===orig,element=pieceElementByKey(s,orig);if(piece&&element&&stillSelected&&board.isDraggable(s,orig)){s.draggable.current={orig:orig,piece:piece,origPos:position,pos:position,started:s.draggable.autoDistance&&s.stats.dragged,element:element,previouslySelected:previouslySelected,originTarget:e.target},element.cgDragging=!0,element.classList.add("dragging");var ghost=s.dom.elements.ghost;ghost&&(ghost.className="ghost "+piece.color+" "+piece.role,util.translateAbs(ghost,util.posToTranslateAbs(bounds)(util.key2pos(orig),board.whitePov(s))),util.setVisible(ghost,!0)),processDrag(s)}else hadPremove&&board.unsetPremove(s),hadPredrop&&board.unsetPredrop(s);s.dom.redraw()}}}function pieceCloseTo(s,pos){var asWhite=board.whitePov(s),bounds=s.dom.bounds(),radiusSq=Math.pow(bounds.width/8,2);for(var key in s.pieces){var center=util.computeSquareCenter(key,asWhite,bounds);if(util.distanceSq(center,pos)<=radiusSq)return!0}return!1}function dragNewPiece(s,piece,e,force){s.pieces.set("a0",piece),s.dom.redraw();var position=util.eventPosition(e);s.draggable.current={orig:"a0",piece:piece,origPos:position,pos:position,started:!0,element:function(){return pieceElementByKey(s,"a0")},originTarget:e.target,newPiece:!0,force:!!force},processDrag(s)}function processDrag(s){requestAnimationFrame(function(){var _a,cur=s.draggable.current;if(cur){(null===(_a=s.animation.current)||void 0===_a?void 0:_a.plan.anims.has(cur.orig))&&(s.animation.current=void 0);var origPiece=s.pieces.get(cur.orig);if(origPiece&&util.samePiece(origPiece,cur.piece)){if(!cur.started&&util.distanceSq(cur.pos,cur.origPos)>=Math.pow(s.draggable.distance,2)&&(cur.started=!0),cur.started){if("function"==typeof cur.element){var found=cur.element();if(!found)return;found.cgDragging=!0,found.classList.add("dragging"),cur.element=found}var bounds=s.dom.bounds();util.translateAbs(cur.element,[cur.pos[0]-bounds.left-bounds.width/16,cur.pos[1]-bounds.top-bounds.height/16])}}else cancel(s);processDrag(s)}})}function move(s,e){s.draggable.current&&(!e.touches||e.touches.length<2)&&(s.draggable.current.pos=util.eventPosition(e))}function end(s,e){var cur=s.draggable.current;if(cur){if("touchend"===e.type&&!1!==e.cancelable&&e.preventDefault(),"touchend"===e.type&&cur.originTarget!==e.target&&!cur.newPiece)return void(s.draggable.current=void 0);board.unsetPremove(s),board.unsetPredrop(s);var eventPos=util.eventPosition(e)||cur.pos,dest=board.getKeyAtDomPos(eventPos,board.whitePov(s),s.dom.bounds());dest&&cur.started&&cur.orig!==dest?cur.newPiece?board.dropNewPiece(s,cur.orig,dest,cur.force):(s.stats.ctrlKey=e.ctrlKey,board.userMove(s,cur.orig,dest)&&(s.stats.dragged=!0)):cur.newPiece?s.pieces.delete(cur.orig):s.draggable.deleteOnDropOff&&!dest&&(s.pieces.delete(cur.orig),board.callUserFunction(s.events.change)),cur.orig!==cur.previouslySelected||cur.orig!==dest&&dest?s.selectable.enabled||board.unselect(s):board.unselect(s),removeDragElements(s),s.draggable.current=void 0,s.dom.redraw()}}function cancel(s){var cur=s.draggable.current;cur&&(cur.newPiece&&s.pieces.delete(cur.orig),s.draggable.current=void 0,board.unselect(s),removeDragElements(s),s.dom.redraw())}function removeDragElements(s){var e=s.dom.elements;e.ghost&&util.setVisible(e.ghost,!1)}function pieceElementByKey(s,key){for(var el=s.dom.elements.board.firstChild;el;){if(el.cgKey===key&&"PIECE"===el.tagName)return el;el=el.nextSibling}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.cancel=exports.end=exports.move=exports.dragNewPiece=exports.start=void 0;var board=__webpack_require__(1),util=__webpack_require__(0),draw_1=__webpack_require__(7),anim_1=__webpack_require__(5);exports.start=start,exports.dragNewPiece=dragNewPiece,exports.move=move,exports.end=end,exports.cancel=cancel},function(module,exports,__webpack_require__){"use strict";function read(fen){"start"===fen&&(fen=exports.initial);var pieces=new Map,row=7,col=0,_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=fen[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var c=_step.value;switch(c){case" ":return pieces;case"/":if(--row<0)return pieces;col=0;break;case"~":var piece=pieces.get(util_1.pos2key([col,row]));piece&&(piece.promoted=!0);break;default:var nb=c.charCodeAt(0);if(nb<57)col+=nb-48;else{var role=c.toLowerCase();pieces.set(util_1.pos2key([col,row]),{role:roles[role],color:c===role?"black":"white"}),++col}}}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}return pieces}function write(pieces){return util_1.invRanks.map(function(y){return cg.files.map(function(x){var piece=pieces.get(x+y);if(piece){var letter=letters[piece.role];return"white"===piece.color?letter.toUpperCase():letter}return"1"}).join("")}).join("/").replace(/1{2,}/g,function(s){return s.length.toString()})}Object.defineProperty(exports,"__esModule",{value:!0}),exports.write=exports.read=exports.initial=void 0;var util_1=__webpack_require__(0),cg=__webpack_require__(4);exports.initial="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR";var roles={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king",e:"elephant"},letters={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k",elephant:"e"};exports.read=read,exports.write=write},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ranks=exports.files=exports.colors=void 0,exports.colors=["white","black"],exports.files=["a","b","c","d","e","f","g","h"],exports.ranks=["1","2","3","4","5","6","7","8"]},function(module,exports,__webpack_require__){"use strict";function anim(mutation,state){return state.animation.enabled?animate(mutation,state):render(mutation,state)}function render(mutation,state){var result=mutation(state);return state.dom.redraw(),result}function makePiece(key,piece){return{key:key,pos:util.key2pos(key),piece:piece}}function closer(piece,pieces){return pieces.sort(function(p1,p2){return util.distanceSq(piece.pos,p1.pos)-util.distanceSq(piece.pos,p2.pos)})[0]}function computePlan(prevPieces,current){var anims=new Map,animedOrigs=[],fadings=new Map,missings=[],news=[],prePieces=new Map,curP=void 0,preP=void 0,vector=void 0,_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=prevPieces[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var _step$value=_slicedToArray(_step.value,2),k=_step$value[0],p=_step$value[1];prePieces.set(k,makePiece(k,p))}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}var _iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=util.allKeys[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var key=_step2.value;curP=current.pieces.get(key),preP=prePieces.get(key),curP?preP?util.samePiece(curP,preP.piece)||(missings.push(preP),news.push(makePiece(key,curP))):news.push(makePiece(key,curP)):preP&&missings.push(preP)}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2.return&&_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}var _iteratorNormalCompletion3=!0,_didIteratorError3=!1,_iteratorError3=void 0;try{for(var _step3,_iterator3=news[Symbol.iterator]();!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=!0)!function(){var newP=_step3.value;(preP=closer(newP,missings.filter(function(p){return util.samePiece(newP.piece,p.piece)})))&&(vector=[preP.pos[0]-newP.pos[0],preP.pos[1]-newP.pos[1]],anims.set(newP.key,vector.concat(vector)),animedOrigs.push(preP.key))}()}catch(err){_didIteratorError3=!0,_iteratorError3=err}finally{try{!_iteratorNormalCompletion3&&_iterator3.return&&_iterator3.return()}finally{if(_didIteratorError3)throw _iteratorError3}}var _iteratorNormalCompletion4=!0,_didIteratorError4=!1,_iteratorError4=void 0;try{for(var _step4,_iterator4=missings[Symbol.iterator]();!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=!0){var p=_step4.value;animedOrigs.includes(p.key)||fadings.set(p.key,p.piece)}}catch(err){_didIteratorError4=!0,_iteratorError4=err}finally{try{!_iteratorNormalCompletion4&&_iterator4.return&&_iterator4.return()}finally{if(_didIteratorError4)throw _iteratorError4}}return{anims:anims,fadings:fadings}}function step(state,now){var cur=state.animation.current;if(void 0===cur)return void(state.dom.destroyed||state.dom.redrawNow());var rest=1-(now-cur.start)*cur.frequency;if(rest<=0)state.animation.current=void 0,state.dom.redrawNow();else{var ease=easing(rest),_iteratorNormalCompletion5=!0,_didIteratorError5=!1,_iteratorError5=void 0;try{for(var _step5,_iterator5=cur.plan.anims.values()[Symbol.iterator]();!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=!0){var cfg=_step5.value;cfg[2]=cfg[0]*ease,cfg[3]=cfg[1]*ease}}catch(err){_didIteratorError5=!0,_iteratorError5=err}finally{try{!_iteratorNormalCompletion5&&_iterator5.return&&_iterator5.return()}finally{if(_didIteratorError5)throw _iteratorError5}}state.dom.redrawNow(!0),requestAnimationFrame(function(){var now=arguments.length>0&&void 0!==arguments[0]?arguments[0]:performance.now();return step(state,now)})}}function animate(mutation,state){var prevPieces=new Map(state.pieces),result=mutation(state),plan=computePlan(prevPieces,state);if(plan.anims.size||plan.fadings.size){var alreadyRunning=state.animation.current&&state.animation.current.start;state.animation.current={start:performance.now(),frequency:1/state.animation.duration,plan:plan},alreadyRunning||step(state,performance.now())}else state.dom.redraw();return result}function easing(t){return t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1}var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{!_n&&_i.return&&_i.return()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr))return arr;if(Symbol.iterator in Object(arr))return sliceIterator(arr,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.render=exports.anim=void 0;var util=__webpack_require__(0);exports.anim=anim,exports.render=render},function(module,exports,__webpack_require__){"use strict";function configure(state,config){var _a;if((null===(_a=config.movable)||void 0===_a?void 0:_a.dests)&&(state.movable.dests=void 0),merge(state,config),config.fen&&(state.pieces=fen_1.read(config.fen),state.drawable.shapes=[]),config.hasOwnProperty("check")&&board_1.setCheck(state,config.check||!1),config.hasOwnProperty("lastMove")&&!config.lastMove?state.lastMove=void 0:config.lastMove&&(state.lastMove=config.lastMove),state.selected&&board_1.setSelected(state,state.selected),(!state.animation.duration||state.animation.duration<100)&&(state.animation.enabled=!1),!state.movable.rookCastle&&state.movable.dests){var rank="white"===state.movable.color?"1":"8",kingStartPos="e"+rank,dests=state.movable.dests.get(kingStartPos),king=state.pieces.get(kingStartPos);if(!dests||!king||"king"!==king.role)return;state.movable.dests.set(kingStartPos,dests.filter(function(d){return!(d==="a"+rank&&dests.includes("c"+rank)||d==="h"+rank&&dests.includes("g"+rank))}))}}function merge(base,extend){for(var key in extend)isObject(base[key])&&isObject(extend[key])?merge(base[key],extend[key]):base[key]=extend[key]}function isObject(o){return"object"===(void 0===o?"undefined":_typeof(o))}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};Object.defineProperty(exports,"__esModule",{value:!0}),exports.configure=void 0;var board_1=__webpack_require__(1),fen_1=__webpack_require__(3);exports.configure=configure},function(module,exports,__webpack_require__){"use strict";function start(state,e){if(!(e.touches&&e.touches.length>1)){e.stopPropagation(),e.preventDefault(),e.ctrlKey?board_1.unselect(state):board_1.cancelMove(state);var pos=util_1.eventPosition(e),orig=board_1.getKeyAtDomPos(pos,board_1.whitePov(state),state.dom.bounds());orig&&(state.drawable.current={orig:orig,pos:pos,brush:eventBrush(e),snapToValidMove:state.drawable.defaultSnapToValidMove},processDraw(state))}}function processDraw(state){requestAnimationFrame(function(){var cur=state.drawable.current;if(cur){var keyAtDomPos=board_1.getKeyAtDomPos(cur.pos,board_1.whitePov(state),state.dom.bounds());keyAtDomPos||(cur.snapToValidMove=!1);var mouseSq=cur.snapToValidMove?board_1.getSnappedKeyAtDomPos(cur.orig,cur.pos,board_1.whitePov(state),state.dom.bounds()):keyAtDomPos;mouseSq!==cur.mouseSq&&(cur.mouseSq=mouseSq,cur.dest=mouseSq!==cur.orig?mouseSq:void 0,state.dom.redrawNow()),processDraw(state)}})}function move(state,e){state.drawable.current&&(state.drawable.current.pos=util_1.eventPosition(e))}function end(state){var cur=state.drawable.current;cur&&(cur.mouseSq&&addShape(state.drawable,cur),cancel(state))}function cancel(state){state.drawable.current&&(state.drawable.current=void 0,state.dom.redraw())}function clear(state){state.drawable.shapes.length&&(state.drawable.shapes=[],state.dom.redraw(),onChange(state.drawable))}function eventBrush(e){var _a,modA=(e.shiftKey||e.ctrlKey)&&util_1.isRightButton(e),modB=e.altKey||e.metaKey||(null===(_a=e.getModifierState)||void 0===_a?void 0:_a.call(e,"AltGraph"));return brushes[(modA?1:0)+(modB?2:0)]}function addShape(drawable,cur){var sameShape=function(s){return s.orig===cur.orig&&s.dest===cur.dest},similar=drawable.shapes.find(sameShape);similar&&(drawable.shapes=drawable.shapes.filter(function(s){return!sameShape(s)})),similar&&similar.brush===cur.brush||drawable.shapes.push(cur),onChange(drawable)}function onChange(drawable){drawable.onChange&&drawable.onChange(drawable.shapes)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.clear=exports.cancel=exports.end=exports.move=exports.processDraw=exports.start=void 0;var board_1=__webpack_require__(1),util_1=__webpack_require__(0),brushes=["green","red","blue","yellow"];exports.start=start,exports.processDraw=processDraw,exports.move=move,exports.end=end,exports.cancel=cancel,exports.clear=clear},function(module,exports,__webpack_require__){"use strict";function createElement(tagName){return document.createElementNS("http://www.w3.org/2000/svg",tagName)}function renderSvg(state,root){var d=state.drawable,curD=d.current,cur=curD&&curD.mouseSq?curD:void 0,arrowDests=new Map,bounds=state.dom.bounds(),_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=d.shapes.concat(d.autoShapes).concat(cur?[cur]:[])[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var s=_step.value;s.dest&&arrowDests.set(s.dest,(arrowDests.get(s.dest)||0)+1)}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}var shapes=d.shapes.concat(d.autoShapes).map(function(s){return{shape:s,current:!1,hash:shapeHash(s,arrowDests,!1,bounds)}});cur&&shapes.push({shape:cur,current:!0,hash:shapeHash(cur,arrowDests,!0,bounds)});var fullHash=shapes.map(function(sc){return sc.hash}).join(";");if(fullHash!==state.drawable.prevSvgHash){state.drawable.prevSvgHash=fullHash;var defsEl=root.firstChild;syncDefs(d,shapes,defsEl),syncShapes(state,shapes,d.brushes,arrowDests,root,defsEl)}}function syncDefs(d,shapes,defsEl){var brushes=new Map,brush=void 0,_iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=shapes[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var s=_step2.value;s.shape.dest&&(brush=d.brushes[s.shape.brush],s.shape.modifiers&&(brush=makeCustomBrush(brush,s.shape.modifiers)),brushes.set(brush.key,brush))}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2.return&&_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}for(var keysInDom=new Set,el=defsEl.firstChild;el;)keysInDom.add(el.getAttribute("cgKey")),el=el.nextSibling;var _iteratorNormalCompletion3=!0,_didIteratorError3=!1,_iteratorError3=void 0;try{for(var _step3,_iterator3=brushes.entries()[Symbol.iterator]();!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=!0){var _step3$value=_slicedToArray(_step3.value,2),key=_step3$value[0],_brush=_step3$value[1];keysInDom.has(key)||defsEl.appendChild(renderMarker(_brush))}}catch(err){_didIteratorError3=!0,_iteratorError3=err}finally{try{!_iteratorNormalCompletion3&&_iterator3.return&&_iterator3.return()}finally{if(_didIteratorError3)throw _iteratorError3}}}function syncShapes(state,shapes,brushes,arrowDests,root,defsEl){var bounds=state.dom.bounds(),hashesInDom=new Map,toRemove=[],_iteratorNormalCompletion4=!0,_didIteratorError4=!1,_iteratorError4=void 0;try{for(var _step4,_iterator4=shapes[Symbol.iterator]();!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=!0){var sc=_step4.value;hashesInDom.set(sc.hash,!1)}}catch(err){_didIteratorError4=!0,_iteratorError4=err}finally{try{!_iteratorNormalCompletion4&&_iterator4.return&&_iterator4.return()}finally{if(_didIteratorError4)throw _iteratorError4}}for(var el=defsEl.nextSibling,elHash=void 0;el;)elHash=el.getAttribute("cgHash"),hashesInDom.has(elHash)?hashesInDom.set(elHash,!0):toRemove.push(el),el=el.nextSibling;var _iteratorNormalCompletion5=!0,_didIteratorError5=!1,_iteratorError5=void 0;try{for(var _step5,_iterator5=toRemove[Symbol.iterator]();!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=!0){var _el=_step5.value;root.removeChild(_el)}}catch(err){_didIteratorError5=!0,_iteratorError5=err}finally{try{!_iteratorNormalCompletion5&&_iterator5.return&&_iterator5.return()}finally{if(_didIteratorError5)throw _iteratorError5}}var _iteratorNormalCompletion6=!0,_didIteratorError6=!1,_iteratorError6=void 0;try{for(var _step6,_iterator6=shapes[Symbol.iterator]();!(_iteratorNormalCompletion6=(_step6=_iterator6.next()).done);_iteratorNormalCompletion6=!0){var _sc=_step6.value;hashesInDom.get(_sc.hash)||root.appendChild(renderShape(state,_sc,brushes,arrowDests,bounds))}}catch(err){_didIteratorError6=!0,_iteratorError6=err}finally{try{!_iteratorNormalCompletion6&&_iterator6.return&&_iterator6.return()}finally{if(_didIteratorError6)throw _iteratorError6}}}function shapeHash(_ref,arrowDests,current,bounds){var orig=_ref.orig,dest=_ref.dest,brush=_ref.brush,piece=_ref.piece,modifiers=_ref.modifiers;return[bounds.width,bounds.height,current,orig,dest,brush,dest&&(arrowDests.get(dest)||0)>1,piece&&pieceHash(piece),modifiers&&modifiersHash(modifiers)].filter(function(x){return x}).join(",")}function pieceHash(piece){return[piece.color,piece.role,piece.scale].filter(function(x){return x}).join(",")}function modifiersHash(m){return""+(m.lineWidth||"")}function renderShape(state,_ref2,brushes,arrowDests,bounds){var shape=_ref2.shape,current=_ref2.current,hash=_ref2.hash,el=void 0;if(shape.piece)el=renderPiece(state.drawable.pieces.baseUrl,orient(util_1.key2pos(shape.orig),state.orientation),shape.piece,bounds);else{var orig=orient(util_1.key2pos(shape.orig),state.orientation);if(shape.dest){var brush=brushes[shape.brush];shape.modifiers&&(brush=makeCustomBrush(brush,shape.modifiers)),el=renderArrow(brush,orig,orient(util_1.key2pos(shape.dest),state.orientation),current,(arrowDests.get(shape.dest)||0)>1,bounds)}else el=renderCircle(brushes[shape.brush],orig,current,bounds)}return el.setAttribute("cgHash",hash),el}function renderCircle(brush,pos,current,bounds){var o=pos2px(pos,bounds),widths=circleWidth(bounds),radius=(bounds.width+bounds.height)/32;return setAttributes(createElement("circle"),{stroke:brush.color,"stroke-width":widths[current?0:1],fill:"none",opacity:opacity(brush,current),cx:o[0],cy:o[1],r:radius-widths[1]/2})}function renderArrow(brush,orig,dest,current,shorten,bounds){var m=arrowMargin(bounds,shorten&&!current),a=pos2px(orig,bounds),b=pos2px(dest,bounds),dx=b[0]-a[0],dy=b[1]-a[1],angle=Math.atan2(dy,dx),xo=Math.cos(angle)*m,yo=Math.sin(angle)*m;return setAttributes(createElement("line"),{stroke:brush.color,"stroke-width":lineWidth(brush,current,bounds),"stroke-linecap":"round","marker-end":"url(#arrowhead-"+brush.key+")",opacity:opacity(brush,current),x1:a[0],y1:a[1],x2:b[0]-xo,y2:b[1]-yo})}function renderPiece(baseUrl,pos,piece,bounds){var o=pos2px(pos,bounds),size=bounds.width/8*(piece.scale||1),name=piece.color[0]+("knight"===piece.role?"n":piece.role[0]).toUpperCase();return setAttributes(createElement("image"),{className:piece.role+" "+piece.color,x:o[0]-size/2,y:o[1]-size/2,width:size,height:size,href:baseUrl+name+".svg"})}function renderMarker(brush){var marker=setAttributes(createElement("marker"),{id:"arrowhead-"+brush.key,orient:"auto",markerWidth:4,markerHeight:8,refX:2.05,refY:2.01});return marker.appendChild(setAttributes(createElement("path"),{d:"M0,0 V4 L3,2 Z",fill:brush.color})),marker.setAttribute("cgKey",brush.key),marker}function setAttributes(el,attrs){for(var key in attrs)el.setAttribute(key,attrs[key]);return el}function orient(pos,color){return"white"===color?pos:[7-pos[0],7-pos[1]]}function makeCustomBrush(base,modifiers){return{color:base.color,opacity:Math.round(10*base.opacity)/10,lineWidth:Math.round(modifiers.lineWidth||base.lineWidth),key:[base.key,modifiers.lineWidth].filter(function(x){return x}).join("")}}function circleWidth(bounds){var base=bounds.width/512;return[3*base,4*base]}function lineWidth(brush,current,bounds){return(brush.lineWidth||10)*(current?.85:1)/512*bounds.width}function opacity(brush,current){return(brush.opacity||1)*(current?.9:1)}function arrowMargin(bounds,shorten){return(shorten?20:10)/512*bounds.width}function pos2px(pos,bounds){return[(pos[0]+.5)*bounds.width/8,(7.5-pos[1])*bounds.height/8]}var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{!_n&&_i.return&&_i.return()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr))return arr;if(Symbol.iterator in Object(arr))return sliceIterator(arr,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.renderSvg=exports.createElement=void 0;var util_1=__webpack_require__(0);exports.createElement=createElement,exports.renderSvg=renderSvg},function(module,exports){var g,_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};g=function(){return this}();try{g=g||Function("return this")()||(0,eval)("this")}catch(e){"object"===("undefined"==typeof window?"undefined":_typeof(window))&&(g=window)}module.exports=g},function(module,exports,__webpack_require__){var Component=__webpack_require__(24)(__webpack_require__(23),__webpack_require__(25),null,null);module.exports=Component.exports},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_RESULT__,_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},Echess=function(fen){function _clear(keep_headers){void 0===keep_headers&&(keep_headers=!1),_board=new Array(128),kings={w:EMPTY,b:EMPTY},_turn=WHITE,castling={w:0,b:0},ep_square=EMPTY,half_moves=0,move_number=1,_history=[],keep_headers||(header={}),comments={},update_setup(generate_fen())}function prune_comments(){for(var reversed_history=[],current_comments={},copy_comment=(function(fen){fen in comments&&(current_comments[fen]=comments[fen])});_history.length>0;)reversed_history.push(undo_move());for(copy_comment(generate_fen());reversed_history.length>0;)make_move(reversed_history.pop()),copy_comment(generate_fen());comments=current_comments}function _reset(){_load(DEFAULT_POSITION)}function _load(fen,keep_headers){void 0===keep_headers&&(keep_headers=!1);var tokens=fen.split(/\s+/),position=tokens[0],square=0;if(!_validate_fen(fen).valid)return!1;_clear(keep_headers);for(var i=0;i<position.length;i++){var piece=position.charAt(i);if("/"===piece)square+=8;else if(is_digit(piece))square+=parseInt(piece,10);else{var color=piece<"a"?WHITE:BLACK;_put({type:piece.toLowerCase(),color:color},algebraic(square)),square++}}return _turn=tokens[1],tokens[2].indexOf("K")>-1&&(castling.w|=BITS.KSIDE_CASTLE),tokens[2].indexOf("Q")>-1&&(castling.w|=BITS.QSIDE_CASTLE),tokens[2].indexOf("k")>-1&&(castling.b|=BITS.KSIDE_CASTLE),tokens[2].indexOf("q")>-1&&(castling.b|=BITS.QSIDE_CASTLE),ep_square="-"===tokens[3]?EMPTY:SQUARES[tokens[3]],half_moves=parseInt(tokens[4],10),move_number=parseInt(tokens[5],10),update_setup(generate_fen()),!0}function _validate_fen(fen){var errors={0:"No errors.",1:"FEN string must contain six space-delimited fields.",2:"6th field (move number) must be a positive integer.",3:"5th field (half move counter) must be a non-negative integer.",4:"4th field (en-passant square) is invalid.",5:"3rd field (castling availability) is invalid.",6:"2nd field (side to move) is invalid.",7:"1st field (piece positions) does not contain 8 '/'-delimited rows.",8:"1st field (piece positions) is invalid [consecutive numbers].",9:"1st field (piece positions) is invalid [invalid piece].",10:"1st field (piece positions) is invalid [row too large].",11:"Illegal en-passant square"},tokens=fen.split(/\s+/);if(6!==tokens.length)return{valid:!1,error_number:1,error:errors[1]};if(isNaN(tokens[5])||parseInt(tokens[5],10)<=0)return{valid:!1,error_number:2,error:errors[2]};if(isNaN(tokens[4])||parseInt(tokens[4],10)<0)return{valid:!1,error_number:3,error:errors[3]};if(!/^(-|[abcdefgh][36])$/.test(tokens[3]))return{valid:!1,error_number:4,error:errors[4]};if(!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(tokens[2]))return{valid:!1,error_number:5,error:errors[5]};if(!/^(w|b)$/.test(tokens[1]))return{valid:!1,error_number:6,error:errors[6]};for(var rows=tokens[0].split("/"),i=0;i<rows.length;i++){for(var sum_fields=0,previous_was_number=!1,k=0;k<rows[i].length;k++)if(isNaN(rows[i][k])){if(!/^[prnbqkePRNBQKE]$/.test(rows[i][k]))return{valid:!1,error_number:9,error:errors[9]};sum_fields+=1,previous_was_number=!1}else{if(previous_was_number)return{valid:!1,error_number:8,error:errors[8]};sum_fields+=parseInt(rows[i][k],10),previous_was_number=!0}if(8!==sum_fields)return{valid:!1,error_number:10,error:errors[10]}}return"3"==tokens[3][1]&&"w"==tokens[1]||"6"==tokens[3][1]&&"b"==tokens[1]?{valid:!1,error_number:11,error:errors[11]}:{valid:!0,error_number:0,error:errors[0]}}function generate_fen(){for(var empty=0,fen="",i=SQUARES.a8;i<=SQUARES.h1;i++){if(null==_board[i])empty++;else{empty>0&&(fen+=empty,empty=0);var color=_board[i].color,piece=_board[i].type;fen+=color===WHITE?piece.toUpperCase():piece.toLowerCase()}i+1&136&&(empty>0&&(fen+=empty),i!==SQUARES.h1&&(fen+="/"),empty=0,i+=8)}var cflags="";castling[WHITE]&BITS.KSIDE_CASTLE&&(cflags+="K"),castling[WHITE]&BITS.QSIDE_CASTLE&&(cflags+="Q"),castling[BLACK]&BITS.KSIDE_CASTLE&&(cflags+="k"),castling[BLACK]&BITS.QSIDE_CASTLE&&(cflags+="q"),cflags=cflags||"-";var epflags=ep_square===EMPTY?"-":algebraic(ep_square);return[fen,_turn,cflags,epflags,half_moves,move_number].join(" ")}function set_header(args){for(var i=0;i<args.length;i+=2)"string"==typeof args[i]&&"string"==typeof args[i+1]&&(header[args[i]]=args[i+1]);return header}function update_setup(fen){_history.length>0||(fen!==DEFAULT_POSITION?(header.SetUp="1",header.FEN=fen):(delete header.SetUp,delete header.FEN))}function _get(square){var piece=_board[SQUARES[square]];return piece?{type:piece.type,color:piece.color}:null}function _put(piece,square){if(!("type"in piece&&"color"in piece))return!1;if(-1===SYMBOLS.indexOf(piece.type.toLowerCase()))return!1;if(!(square in SQUARES))return!1;var sq=SQUARES[square];return(piece.type!=KING||kings[piece.color]==EMPTY||kings[piece.color]==sq)&&(_board[sq]={type:piece.type,color:piece.color},piece.type===KING&&(kings[piece.color]=sq),update_setup(generate_fen()),!0)}function _remove(square){var piece=_get(square);return _board[SQUARES[square]]=null,piece&&piece.type===KING&&(kings[piece.color]=EMPTY),update_setup(generate_fen()),piece}function find_elephant(){var i=void 0,found=!1;for(i=0;i<_board.length;i++)if(_board[i]&&_board[i].type==ELEPHANT){found=!0;break}return found?i:null}function switch_elephant(color){epos=find_elephant(),epos&&(elephant_owner=color,_board[epos].color=elephant_owner)}function build_move(board,from,to,flags,promotion){var move={color:_turn,from:from,to:to,flags:flags,piece:board[from].type};return promotion&&(move.flags|=BITS.PROMOTION,move.promotion=promotion),board[to]?move.captured=board[to].type:flags&BITS.EP_CAPTURE&&(move.captured=PAWN),move}function generate_moves(options){function add_move(board,moves,from,to,flags){if(!board[to]||board[to].type!==ELEPHANT)if(board[from].type!==PAWN||rank(to)!==RANK_8&&rank(to)!==RANK_1)board[from].type===ELEPHANT?moves.push(build_move(board,from,to,flags)):void 0!==board&&void 0!==board[from]&&void 0!==board[from].type&&moves.push(build_move(board,from,to,flags));else for(var pieces=[QUEEN,ROOK,BISHOP,KNIGHT],i=0,len=pieces.length;i<len;i++)moves.push(build_move(board,from,to,flags,pieces[i]))}var moves=[],us=_turn,them=swap_color(us),second_rank={b:RANK_7,w:RANK_2},first_sq=SQUARES.a8,last_sq=SQUARES.h1,single_square=!1,legal=!(void 0!==options&&"legal"in options)||options.legal;if(void 0!==options&&"square"in options){if(!(options.square in SQUARES))return[];first_sq=last_sq=SQUARES[options.square],single_square=!0}for(var i=first_sq;i<=last_sq;i++)if(136&i)i+=7;else{var piece=_board[i];if(null!=piece&&piece.color===us)if(piece.type===PAWN){var square=i+PAWN_OFFSETS[us][0];if(null==_board[square]){add_move(_board,moves,i,square,BITS.NORMAL);var square=i+PAWN_OFFSETS[us][1];second_rank[us]===rank(i)&&null==_board[square]&&add_move(_board,moves,i,square,BITS.BIG_PAWN)}for(j=2;j<4;j++){var square=i+PAWN_OFFSETS[us][j];136&square||(_board[square]&&_board[square].type===ELEPHANT||(null!=_board[square]&&_board[square].color===them?add_move(_board,moves,i,square,BITS.CAPTURE):square===ep_square&&add_move(_board,moves,i,ep_square,BITS.EP_CAPTURE)))}}else if(piece.type===ELEPHANT)for(var _j=SQUARES.a8;_j<=SQUARES.h1;_j++)136&_j?_j+=7:void 0!==_board[_j]&&null!=_board[_j]||(square=_j,add_move(_board,moves,i,square,BITS.NORMAL));else for(var j=0,len=PIECE_OFFSETS[piece.type].length;j<len;j++)for(var offset=PIECE_OFFSETS[piece.type][j],square=i;;){if(136&(square+=offset))break;if(null!=_board[square]){if(_board[square].color===us)break;add_move(_board,moves,i,square,BITS.CAPTURE);break}if(add_move(_board,moves,i,square,BITS.NORMAL),"n"===piece.type||"k"===piece.type)break}}if(!single_square||last_sq===kings[us]){if(castling[us]&BITS.KSIDE_CASTLE){var castling_from=kings[us],castling_to=castling_from+2;null!=_board[castling_from+1]||null!=_board[castling_to]||attacked(them,kings[us])||attacked(them,castling_from+1)||attacked(them,castling_to)||add_move(_board,moves,kings[us],castling_to,BITS.KSIDE_CASTLE)}if(castling[us]&BITS.QSIDE_CASTLE){var castling_from=kings[us],castling_to=castling_from-2;null!=_board[castling_from-1]||null!=_board[castling_from-2]||null!=_board[castling_from-3]||attacked(them,kings[us])||attacked(them,castling_from-1)||attacked(them,castling_to)||add_move(_board,moves,kings[us],castling_to,BITS.QSIDE_CASTLE)}}if(!legal)return moves;for(var legal_moves=[],i=0,len=moves.length;i<len;i++)make_move(moves[i]),king_attacked(us)||legal_moves.push(moves[i]),undo_move();return legal_moves}function move_to_san(move,sloppy){var output="";if(move.flags&BITS.KSIDE_CASTLE)output="O-O";else if(move.flags&BITS.QSIDE_CASTLE)output="O-O-O";else{var disambiguator;disambiguator=get_disambiguator(move,sloppy),move.piece!==PAWN&&(output+=move.piece.toUpperCase()+disambiguator),move.flags&(BITS.CAPTURE|BITS.EP_CAPTURE)&&(move.piece===PAWN&&(output+=algebraic(move.from)[0]),output+="x"),output+=algebraic(move.to),move.flags&BITS.PROMOTION&&(output+="="+move.promotion.toUpperCase())}return make_move(move),_in_check()&&(_in_checkmate()?output+="#":output+="+"),undo_move(),output}function stripped_san(move){return move.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function attacked(color,square){for(var i=SQUARES.a8;i<=SQUARES.h1;i++)if(136&i)i+=7;else if(null!=_board[i]&&_board[i].color===color){var piece=_board[i],difference=i-square,index=difference+119;if(_board[i].type!==ELEPHANT&&ATTACKS[index]&1<<SHIFTS[piece.type]){if(piece.type===PAWN){if(difference>0){if(piece.color===WHITE)return!0}else if(piece.color===BLACK)return!0;continue}if("n"===piece.type||"k"===piece.type)return!0;for(var offset=RAYS[index],j=i+offset,blocked=!1;j!==square;){if(null!=_board[j]){blocked=!0;break}j+=offset}if(!blocked)return!0}}return!1}function king_attacked(color){return attacked(swap_color(color),kings[color])}function _in_check(){return king_attacked(_turn)}function _in_checkmate(){return _in_check()&&0===generate_moves().length}function _in_stalemate(){return!_in_check()&&0===generate_moves().length}function _insufficient_material(){for(var pieces={},bishops=[],num_pieces=0,sq_color=0,i=SQUARES.a8;i<=SQUARES.h1;i++)if(sq_color=(sq_color+1)%2,136&i)i+=7;else{var piece=_board[i];piece&&(pieces[piece.type]=piece.type in pieces?pieces[piece.type]+1:1,piece.type===BISHOP&&bishops.push(sq_color),num_pieces++)}if(2===num_pieces)return!0;if(3===num_pieces&&(1===pieces[BISHOP]||1===pieces[KNIGHT]))return!0;if(num_pieces===pieces[BISHOP]+2){for(var sum=0,len=bishops.length,i=0;i<len;i++)sum+=bishops[i];if(0===sum||sum===len)return!0}return!1}function _in_threefold_repetition(){for(var moves=[],positions={},repetition=!1;;){var move=undo_move();if(!move)break;moves.push(move)}for(;;){var fen=generate_fen().split(" ").slice(0,4).join(" ");if(positions[fen]=fen in positions?positions[fen]+1:1,positions[fen]>=3&&(repetition=!0),!moves.length)break;make_move(moves.pop())}return repetition}function push(move){_history.push({move:move,kings:{b:kings.b,w:kings.w},turn:_turn,castling:{b:castling.b,w:castling.w},ep_square:ep_square,half_moves:half_moves,move_number:move_number})}function make_move(move){var us=_turn,them=swap_color(us);if(push(move),_board[move.to]=_board[move.from],_board[move.from]=null,move.flags&BITS.EP_CAPTURE&&(_turn===BLACK?_board[move.to-16]=null:_board[move.to+16]=null),move.flags&BITS.PROMOTION&&(_board[move.to]={type:move.promotion,color:us}),_board[move.to].type===KING){if(kings[_board[move.to].color]=move.to,move.flags&BITS.KSIDE_CASTLE){var castling_to=move.to-1,castling_from=move.to+1;_board[castling_to]=_board[castling_from],_board[castling_from]=null}else if(move.flags&BITS.QSIDE_CASTLE){var castling_to=move.to+1,castling_from=move.to-2;_board[castling_to]=_board[castling_from],_board[castling_from]=null}castling[us]=""}if(castling[us])for(var i=0,len=ROOKS[us].length;i<len;i++)if(move.from===ROOKS[us][i].square&&castling[us]&ROOKS[us][i].flag){castling[us]^=ROOKS[us][i].flag;break}if(castling[them])for(var i=0,len=ROOKS[them].length;i<len;i++)if(move.to===ROOKS[them][i].square&&castling[them]&ROOKS[them][i].flag){castling[them]^=ROOKS[them][i].flag;break}ep_square=move.flags&BITS.BIG_PAWN?"b"===_turn?move.to-16:move.to+16:EMPTY,move.piece===PAWN?half_moves=0:move.flags&(BITS.CAPTURE|BITS.EP_CAPTURE)?half_moves=0:half_moves++,_turn===BLACK&&move_number++,_turn=swap_color(_turn)}function undo_move(){var old=_history.pop();if(null==old)return null;var move=old.move;kings=old.kings,_turn=old.turn,castling=old.castling,ep_square=old.ep_square,half_moves=old.half_moves,move_number=old.move_number;var us=_turn,them=swap_color(_turn);if(_board[move.from]=_board[move.to],_board[move.from].type=move.piece,_board[move.to]=null,move.flags&BITS.CAPTURE)_board[move.to]={type:move.captured,color:them};else if(move.flags&BITS.EP_CAPTURE){var index;index=us===BLACK?move.to-16:move.to+16,_board[index]={type:PAWN,color:them}}if(move.flags&(BITS.KSIDE_CASTLE|BITS.QSIDE_CASTLE)){var castling_to,castling_from;move.flags&BITS.KSIDE_CASTLE?(castling_to=move.to+1,castling_from=move.to-1):move.flags&BITS.QSIDE_CASTLE&&(castling_to=move.to-2,castling_from=move.to+1),_board[castling_to]=_board[castling_from],_board[castling_from]=null}return move}function get_disambiguator(move,sloppy){for(var moves=generate_moves({legal:!sloppy}),from=move.from,to=move.to,piece=move.piece,ambiguities=0,same_rank=0,same_file=0,i=0,len=moves.length;i<len;i++){var ambig_from=moves[i].from,ambig_to=moves[i].to;piece===moves[i].piece&&from!==ambig_from&&to===ambig_to&&(ambiguities++,rank(from)===rank(ambig_from)&&same_rank++,file(from)===file(ambig_from)&&same_file++)}return ambiguities>0?same_rank>0&&same_file>0?algebraic(from):same_file>0?algebraic(from).charAt(1):algebraic(from).charAt(0):""}function _ascii(){for(var s="   +------------------------+\n",i=SQUARES.a8;i<=SQUARES.h1;i++){if(0===file(i)&&(s+=" "+"87654321"[rank(i)]+" |"),null==_board[i])s+=" . ";else{var piece=_board[i].type;s+=" "+(_board[i].color===WHITE?piece.toUpperCase():piece.toLowerCase())+" "}i+1&136&&(s+="|\n",i+=8)}return s+="   +------------------------+\n",s+="     a  b  c  d  e  f  g  h\n"}function move_from_san(move,sloppy){var clean_move=stripped_san(move);if(sloppy){var matches=clean_move.match(/([pnbrqkPNBRQKE])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBNE])?/);if(matches)var piece=matches[1],from=matches[2],to=matches[3],promotion=matches[4]}for(var moves=generate_moves(),i=0,len=moves.length;i<len;i++){if(clean_move===stripped_san(move_to_san(moves[i]))||sloppy&&clean_move===stripped_san(move_to_san(moves[i],!0)))return moves[i];if(matches&&(!piece||piece.toLowerCase()==moves[i].piece)&&SQUARES[from]==moves[i].from&&SQUARES[to]==moves[i].to&&(!promotion||promotion.toLowerCase()==moves[i].promotion))return moves[i]}return null}function rank(i){return i>>4}function file(i){return 15&i}function algebraic(i){var f=file(i),r=rank(i);return"abcdefgh".substring(f,f+1)+"87654321".substring(r,r+1)}function swap_color(c){return c===WHITE?BLACK:WHITE}function is_digit(c){return-1!=="0123456789".indexOf(c)}function make_pretty(ugly_move){var move=clone(ugly_move);move.san=move_to_san(move,!1),move.to=algebraic(move.to),move.from=algebraic(move.from);var flags="";for(var flag in BITS)BITS[flag]&move.flags&&(flags+=FLAGS[flag]);return move.flags=flags,move}function clone(obj){var dupe=obj instanceof Array?[]:{};for(var property in obj)"object"===(void 0===property?"undefined":_typeof(property))?dupe[property]=clone(obj[property]):dupe[property]=obj[property];return dupe}function trim(str){return str.replace(/^\s+|\s+$/g,"")}function _perft(depth){for(var moves=generate_moves({legal:!1}),nodes=0,color=_turn,i=0,len=moves.length;i<len;i++){if(make_move(moves[i]),!king_attacked(color))if(depth-1>0){var child_nodes=_perft(depth-1);nodes+=child_nodes}else nodes++;undo_move()}return nodes}var BLACK="b",WHITE="w",EMPTY=-1,PAWN="p",KNIGHT="n",BISHOP="b",ROOK="r",QUEEN="q",KING="k",ELEPHANT="e",SYMBOLS="pnbrqkePNBRQKE",DEFAULT_POSITION="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",POSSIBLE_RESULTS=["1-0","0-1","1/2-1/2","*"],PAWN_OFFSETS={b:[16,32,17,15],w:[-16,-32,-17,-15]},PIECE_OFFSETS={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},ATTACKS=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],RAYS=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],SHIFTS={p:0,n:1,b:2,r:3,q:4,k:5},FLAGS={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},BITS={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},RANK_1=7,RANK_2=6,RANK_7=1,RANK_8=0,SQUARES={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},ROOKS={w:[{square:SQUARES.a1,flag:BITS.QSIDE_CASTLE},{square:SQUARES.h1,flag:BITS.KSIDE_CASTLE}],b:[{square:SQUARES.a8,flag:BITS.QSIDE_CASTLE},{square:SQUARES.h8,flag:BITS.KSIDE_CASTLE}]},_board=new Array(128),kings={w:EMPTY,b:EMPTY},_turn=WHITE,elephant_owner="",castling={w:0,b:0},ep_square=EMPTY,half_moves=0,move_number=1,_history=[],header={},comments={};return _load(void 0===fen?DEFAULT_POSITION:fen),{WHITE:WHITE,BLACK:BLACK,PAWN:PAWN,KNIGHT:KNIGHT,BISHOP:BISHOP,ROOK:ROOK,QUEEN:QUEEN,KING:KING,ELEPHANT:ELEPHANT,SQUARES:function(){for(var keys=[],i=SQUARES.a8;i<=SQUARES.h1;i++)136&i?i+=7:keys.push(algebraic(i));return keys}(),FLAGS:FLAGS,load:function(fen){return _load(fen)},reset:function(){return _reset()},moves:function(options){for(var ugly_moves=generate_moves(options),moves=[],i=0,len=ugly_moves.length;i<len;i++)void 0!==options&&"verbose"in options&&options.verbose?moves.push(make_pretty(ugly_moves[i])):moves.push(move_to_san(ugly_moves[i],!1));return moves},in_check:function(){return _in_check()},in_checkmate:function(){return _in_checkmate()},in_stalemate:function(){return _in_stalemate()},in_draw:function(){return half_moves>=100||_in_stalemate()||_insufficient_material()||_in_threefold_repetition()},insufficient_material:function(){return _insufficient_material()},in_threefold_repetition:function(){return _in_threefold_repetition()},game_over:function(){return half_moves>=100||_in_checkmate()||_in_stalemate()||_insufficient_material()||_in_threefold_repetition()},validate_fen:function(fen){return _validate_fen(fen)},fen:function(){return generate_fen()},board:function(){for(var output=[],row=[],i=SQUARES.a8;i<=SQUARES.h1;i++)null==_board[i]?row.push(null):row.push({type:_board[i].type,color:_board[i].color}),i+1&136&&(output.push(row),row=[],i+=8);return output},pgn:function(options){var newline="object"===(void 0===options?"undefined":_typeof(options))&&"string"==typeof options.newline_char?options.newline_char:"\n",max_width="object"===(void 0===options?"undefined":_typeof(options))&&"number"==typeof options.max_width?options.max_width:0,result=[],header_exists=!1;for(var i in header)result.push("["+i+' "'+header[i]+'"]'+newline),header_exists=!0;header_exists&&_history.length&&result.push(newline);for(var append_comment=function(move_string){var comment=comments[generate_fen()];if(void 0!==comment){move_string=""+move_string+(move_string.length>0?" ":"")+"{"+comment+"}"}return move_string},reversed_history=[];_history.length>0;)reversed_history.push(undo_move());var moves=[],move_string="";for(0===reversed_history.length&&moves.push(append_comment(""));reversed_history.length>0;){move_string=append_comment(move_string);var move=reversed_history.pop();_history.length||"b"!==move.color?"w"===move.color&&(move_string.length&&moves.push(move_string),move_string=move_number+"."):move_string=move_number+". ...",move_string=move_string+" "+move_to_san(move,!1),make_move(move)}if(move_string.length&&moves.push(append_comment(move_string)),void 0!==header.Result&&moves.push(header.Result),0===max_width)return result.join("")+moves.join(" ");for(var strip=function(){return result.length>0&&" "===result[result.length-1]&&(result.pop(),!0)},current_width=0,i=0;i<moves.length;i++)current_width+moves[i].length>max_width&&moves[i].includes("{")?current_width=function(width,move){var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=move.split(" ")[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var token=_step.value;if(token){if(width+token.length>max_width){for(;strip();)width--;result.push(newline),width=0}result.push(token),width+=token.length,result.push(" "),width++}}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}return strip()&&width--,width}(current_width,moves[i]):(current_width+moves[i].length>max_width&&0!==i?(" "===result[result.length-1]&&result.pop(),result.push(newline),current_width=0):0!==i&&(result.push(" "),current_width++),result.push(moves[i]),current_width+=moves[i].length);return result.join("")},load_pgn:function(pgn,options){function mask(str){return str.replace(/\\/g,"\\")}var sloppy=void 0!==options&&"sloppy"in options&&options.sloppy,newline_char="object"===(void 0===options?"undefined":_typeof(options))&&"string"==typeof options.newline_char?options.newline_char:"\r?\n",header_regex=new RegExp("^(\\[((?:"+mask(newline_char)+")|.)*\\])(?:"+mask(newline_char)+"){2}"),header_string=header_regex.test(pgn)?header_regex.exec(pgn)[1]:"";_reset();var headers=function(header,options){for(var newline_char="object"===(void 0===options?"undefined":_typeof(options))&&"string"==typeof options.newline_char?options.newline_char:"\r?\n",header_obj={},headers=header.split(new RegExp(mask(newline_char))),key="",value="",i=0;i<headers.length;i++)key=headers[i].replace(/^\[([A-Z][A-Za-z]*)\s.*\]$/,"$1"),value=headers[i].replace(/^\[[A-Za-z]+\s"(.*)"\ *\]$/,"$1"),trim(key).length>0&&(header_obj[key]=value);return header_obj}(header_string,options);for(var key in headers)set_header([key,headers[key]]);if("1"===headers.SetUp&&!("FEN"in headers&&_load(headers.FEN,!0)))return!1;for(var to_hex=function(string){return Array.from(string).map(function(c){return c.charCodeAt(0)<128?c.charCodeAt(0).toString(16):encodeURIComponent(c).replace(/\%/g,"").toLowerCase()}).join("")},from_hex=function(string){return 0==string.length?"":decodeURIComponent("%"+string.match(/.{1,2}/g).join("%"))},encode_comment=function(string){return string=string.replace(new RegExp(mask(newline_char),"g")," "),"{"+to_hex(string.slice(1,string.length-1))+"}"},decode_comment=function(string){if(string.startsWith("{")&&string.endsWith("}"))return from_hex(string.slice(1,string.length-1))},ms=pgn.replace(header_string,"").replace(new RegExp("({[^}]*})+?|;([^"+mask(newline_char)+"]*)","g"),function(match,bracket,semicolon){return void 0!==bracket?encode_comment(bracket):" "+encode_comment("{"+semicolon.slice(1)+"}")}).replace(new RegExp(mask(newline_char),"g")," "),rav_regex=/(\([^\(\)]+\))+?/g;rav_regex.test(ms);)ms=ms.replace(rav_regex,"");ms=ms.replace(/\d+\.(\.\.)?/g,""),ms=ms.replace(/\.\.\./g,""),ms=ms.replace(/\$\d+/g,"");var moves=trim(ms).split(new RegExp(/\s+/));moves=moves.join(",").replace(/,,+/g,",").split(",");for(var move="",half_move=0;half_move<moves.length-1;half_move++){var comment=decode_comment(moves[half_move]);if(void 0===comment){if(null==(move=move_from_san(moves[half_move],sloppy)))return!1;make_move(move)}else comments[generate_fen()]=comment}if(comment=decode_comment(moves[moves.length-1]),void 0!==comment&&(comments[generate_fen()]=comment,moves.pop()),move=moves[moves.length-1],POSSIBLE_RESULTS.indexOf(move)>-1)(function(object){for(var key in object)return!0;return!1})(header)&&void 0===header.Result&&set_header(["Result",move]);else{if(null==(move=move_from_san(move,sloppy)))return!1;make_move(move)}return!0},header:function(){return set_header(arguments)},ascii:function(){return _ascii()},turn:function(){return _turn},move:function(_move,options){var sloppy=void 0!==options&&"sloppy"in options&&options.sloppy,move_obj=null;if("string"==typeof _move)move_obj=move_from_san(_move,sloppy);else if("object"===(void 0===_move?"undefined":_typeof(_move)))for(var moves=generate_moves(),i=0,len=moves.length;i<len;i++)if(!(_move.from!==algebraic(moves[i].from)||_move.to!==algebraic(moves[i].to)||"promotion"in moves[i]&&_move.promotion!==moves[i].promotion)){move_obj=moves[i];break}if(!move_obj)return null;var pretty_move=make_pretty(move_obj);return make_move(move_obj),move_obj.captured&&move_obj.color!==elephant_owner&&switch_elephant(move_obj.color),pretty_move},undo:function(){var move=undo_move();return move?make_pretty(move):null},clear:function(){return _clear()},put:function(piece,square){return _put(piece,square)},get:function(square){return _get(square)},remove:function(square){return _remove(square)},perft:function(depth){return _perft(depth)},square_color:function(square){if(square in SQUARES){var sq_0x88=SQUARES[square];return(rank(sq_0x88)+file(sq_0x88))%2==0?"light":"dark"}return null},history:function(options){for(var reversed_history=[],move_history=[],verbose=(void 0!==options&&"verbose"in options&&options.verbose);_history.length>0;)reversed_history.push(undo_move());for(;reversed_history.length>0;){var move=reversed_history.pop();verbose?move_history.push(make_pretty(move)):move_history.push(move_to_san(move)),make_move(move)}return move_history},get_comment:function(){return comments[generate_fen()]},set_comment:function(comment){comments[generate_fen()]=comment.replace("{","[").replace("}","]")},delete_comment:function(){var comment=comments[generate_fen()];return delete comments[generate_fen()],comment},get_comments:function(){return prune_comments(),Object.keys(comments).map(function(fen){return{fen:fen,comment:comments[fen]}})},delete_comments:function(){return prune_comments(),Object.keys(comments).map(function(fen){var comment=comments[fen];return delete comments[fen],{fen:fen,comment:comment}})}}};exports.Echess=Echess,void 0!==(__WEBPACK_AMD_DEFINE_RESULT__=function(){return Echess}.call(exports,__webpack_require__,exports,module))&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)},function(module,exports,__webpack_require__){"use strict";function start(state,redrawAll){function toggleOrientation(){board.toggleOrientation(state),redrawAll()}return{set:function(config){config.orientation&&config.orientation!==state.orientation&&toggleOrientation(),(config.fen?anim_1.anim:anim_1.render)(function(state){return config_1.configure(state,config)},state)},state:state,getFen:function(){return fen_1.write(state.pieces)},toggleOrientation:toggleOrientation,setPieces:function(pieces){anim_1.anim(function(state){return board.setPieces(state,pieces)},state)},selectSquare:function(key,force){key?anim_1.anim(function(state){return board.selectSquare(state,key,force)},state):state.selected&&(board.unselect(state),state.dom.redraw())},move:function(orig,dest){anim_1.anim(function(state){return board.baseMove(state,orig,dest)},state)},newPiece:function(piece,key){anim_1.anim(function(state){return board.baseNewPiece(state,piece,key)},state)},playPremove:function(){if(state.premovable.current){if(anim_1.anim(board.playPremove,state))return!0;state.dom.redraw()}return!1},playPredrop:function(validate){if(state.predroppable.current){var result=board.playPredrop(state,validate);return state.dom.redraw(),result}return!1},cancelPremove:function(){anim_1.render(board.unsetPremove,state)},cancelPredrop:function(){anim_1.render(board.unsetPredrop,state)},cancelMove:function(){anim_1.render(function(state){board.cancelMove(state),drag_1.cancel(state)},state)},stop:function(){anim_1.render(function(state){board.stop(state),drag_1.cancel(state)},state)},explode:function(keys){explosion_1.explosion(state,keys)},setAutoShapes:function(shapes){anim_1.render(function(state){return state.drawable.autoShapes=shapes},state)},setShapes:function(shapes){anim_1.render(function(state){return state.drawable.shapes=shapes},state)},getKeyAtDomPos:function(pos){return board.getKeyAtDomPos(pos,board.whitePov(state),state.dom.bounds())},redrawAll:redrawAll,dragNewPiece:function(piece,event,force){drag_1.dragNewPiece(state,piece,event,force)},destroy:function(){board.stop(state),state.dom.unbind&&state.dom.unbind(),state.dom.destroyed=!0}}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.start=void 0;var board=__webpack_require__(1),fen_1=__webpack_require__(3),config_1=__webpack_require__(6),anim_1=__webpack_require__(5),drag_1=__webpack_require__(2),explosion_1=__webpack_require__(16);exports.start=start},function(module,exports,__webpack_require__){"use strict";function setDropMode(s,piece){s.dropmode={active:!0,piece:piece},drag_1.cancel(s)}function cancelDropMode(s){s.dropmode={active:!1}}function drop(s,e){if(s.dropmode.active){board.unsetPremove(s),board.unsetPredrop(s);var piece=s.dropmode.piece;if(piece){s.pieces.set("a0",piece);var position=util.eventPosition(e),dest=position&&board.getKeyAtDomPos(position,board.whitePov(s),s.dom.bounds());dest&&board.dropNewPiece(s,"a0",dest)}s.dom.redraw()}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.drop=exports.cancelDropMode=exports.setDropMode=void 0;var board=__webpack_require__(1),util=__webpack_require__(0),drag_1=__webpack_require__(2);exports.setDropMode=setDropMode,exports.cancelDropMode=cancelDropMode,exports.drop=drop},function(module,exports,__webpack_require__){"use strict";function Echessground(element,config){function redrawAll(){var prevUnbind="dom"in maybeState?maybeState.dom.unbind:void 0,relative=maybeState.viewOnly&&!maybeState.drawable.visible,elements=wrap_1.renderWrap(element,maybeState,relative),bounds=util.memo(function(){return elements.board.getBoundingClientRect()}),redrawNow=function(skipSvg){render_1.render(state),!skipSvg&&elements.svg&&svg.renderSvg(state,elements.svg)},boundsUpdated=function(){bounds.clear(),render_1.updateBounds(state),elements.svg&&svg.renderSvg(state,elements.svg)},state=maybeState;return state.dom={elements:elements,bounds:bounds,redraw:debounceRedraw(redrawNow),redrawNow:redrawNow,unbind:prevUnbind,relative:relative},state.drawable.prevSvgHash="",redrawNow(!1),events.bindBoard(state,boundsUpdated),prevUnbind||(state.dom.unbind=events.bindDocument(state,boundsUpdated)),state.events.insert&&state.events.insert(elements),state}var maybeState=state_1.defaults();return config_1.configure(maybeState,config||{}),api_1.start(redrawAll(),redrawAll)}function debounceRedraw(redrawNow){var redrawing=!1;return function(){redrawing||(redrawing=!0,requestAnimationFrame(function(){redrawNow(),redrawing=!1}))}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Echessground=void 0;var api_1=__webpack_require__(12),config_1=__webpack_require__(6),state_1=__webpack_require__(19),wrap_1=__webpack_require__(20),events=__webpack_require__(15),render_1=__webpack_require__(18),svg=__webpack_require__(8),util=__webpack_require__(0);exports.Echessground=Echessground},function(module,exports,__webpack_require__){"use strict";function bindBoard(s,boundsUpdated){var boardEl=s.dom.elements.board;if(!s.dom.relative&&s.resizable&&"ResizeObserver"in window){new window.ResizeObserver(boundsUpdated).observe(boardEl)}if(!s.viewOnly){var onStart=startDragOrDraw(s);boardEl.addEventListener("touchstart",onStart,{passive:!1}),boardEl.addEventListener("mousedown",onStart,{passive:!1}),(s.disableContextMenu||s.drawable.enabled)&&boardEl.addEventListener("contextmenu",function(e){return e.preventDefault()})}}function bindDocument(s,boundsUpdated){var unbinds=[];if(s.dom.relative||!s.resizable||"ResizeObserver"in window||unbinds.push(unbindable(document.body,"echessground.resize",boundsUpdated)),!s.viewOnly){for(var onmove=dragOrDraw(s,drag.move,draw.move),onend=dragOrDraw(s,drag.end,draw.end),_arr=["touchmove","mousemove"],_i=0;_i<_arr.length;_i++){var ev=_arr[_i];unbinds.push(unbindable(document,ev,onmove))}for(var _arr2=["touchend","mouseup"],_i2=0;_i2<_arr2.length;_i2++){var _ev=_arr2[_i2];unbinds.push(unbindable(document,_ev,onend))}var onScroll=function(){return s.dom.bounds.clear()};unbinds.push(unbindable(document,"scroll",onScroll,{capture:!0,passive:!0})),unbinds.push(unbindable(window,"resize",onScroll,{passive:!0}))}return function(){return unbinds.forEach(function(f){return f()})}}function unbindable(el,eventName,callback,options){return el.addEventListener(eventName,callback,options),function(){return el.removeEventListener(eventName,callback,options)}}function startDragOrDraw(s){return function(e){s.draggable.current?drag.cancel(s):s.drawable.current?draw.cancel(s):e.shiftKey||util_1.isRightButton(e)?s.drawable.enabled&&draw.start(s,e):s.viewOnly||(s.dropmode.active?drop_1.drop(s,e):drag.start(s,e))}}function dragOrDraw(s,withDrag,withDraw){return function(e){s.drawable.current?s.drawable.enabled&&withDraw(s,e):s.viewOnly||withDrag(s,e)}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.bindDocument=exports.bindBoard=void 0;var drag=__webpack_require__(2),draw=__webpack_require__(7),drop_1=__webpack_require__(13),util_1=__webpack_require__(0);exports.bindBoard=bindBoard,exports.bindDocument=bindDocument},function(module,exports,__webpack_require__){"use strict";function explosion(state,keys){state.exploding={stage:1,keys:keys},state.dom.redraw(),setTimeout(function(){setStage(state,2),setTimeout(function(){return setStage(state,void 0)},120)},120)}function setStage(state,stage){state.exploding&&(stage?state.exploding.stage=stage:state.exploding=void 0,state.dom.redraw())}Object.defineProperty(exports,"__esModule",{value:!0}),exports.explosion=void 0,exports.explosion=explosion},function(module,exports,__webpack_require__){"use strict";function diff(a,b){return Math.abs(a-b)}function pawn(color){return function(x1,y1,x2,y2){return diff(x1,x2)<2&&("white"===color?y2===y1+1||y1<=1&&y2===y1+2&&x1===x2:y2===y1-1||y1>=6&&y2===y1-2&&x1===x2)}}function king(color,rookFiles,canCastle){return function(x1,y1,x2,y2){return diff(x1,x2)<2&&diff(y1,y2)<2||canCastle&&y1===y2&&y1===("white"===color?0:7)&&(4===x1&&(2===x2&&rookFiles.includes(0)||6===x2&&rookFiles.includes(7))||rookFiles.includes(x2))}}function rookFilesOf(pieces,color){var backrank="white"===color?"1":"8",files=[],_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=pieces[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var _step$value=_slicedToArray(_step.value,2),key=_step$value[0],piece=_step$value[1];key[1]===backrank&&piece.color===color&&"rook"===piece.role&&files.push(util.key2pos(key)[0])}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}return files}function premove(pieces,key,canCastle){var piece=pieces.get(key);if(!piece)return[];var pos=util.key2pos(key),r=piece.role,mobility="pawn"===r?pawn(piece.color):"knight"===r?exports.knight:"bishop"===r?bishop:"rook"===r?rook:"elephant"===r?exports.elephant:"queen"===r?exports.queen:king(piece.color,rookFilesOf(pieces,piece.color),canCastle);return util.allPos.filter(function(pos2){return(pos[0]!==pos2[0]||pos[1]!==pos2[1])&&mobility(pos[0],pos[1],pos2[0],pos2[1])}).map(util.pos2key)}var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{!_n&&_i.return&&_i.return()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr))return arr;if(Symbol.iterator in Object(arr))return sliceIterator(arr,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.premove=exports.queen=exports.elephant=exports.knight=void 0;var util=__webpack_require__(0);exports.knight=function(x1,y1,x2,y2){var xd=diff(x1,x2),yd=diff(y1,y2);return 1===xd&&2===yd||2===xd&&1===yd};var bishop=function(x1,y1,x2,y2){return diff(x1,x2)===diff(y1,y2)},rook=function(x1,y1,x2,y2){return x1===x2||y1===y2};exports.elephant=function(x1,y1,x2,y2){return bishop(x1,y1,x2,y2)||rook(x1,y1,x2,y2)||exports.knight(x1,x2,y1,y2)},exports.queen=function(x1,y1,x2,y2){return bishop(x1,y1,x2,y2)||rook(x1,y1,x2,y2)},exports.premove=premove},function(module,exports,__webpack_require__){"use strict";function render(s){var asWhite=board_1.whitePov(s),posToTranslate=s.dom.relative?util.posToTranslateRel:util.posToTranslateAbs(s.dom.bounds()),translate=s.dom.relative?util.translateRel:util.translateAbs,boardEl=s.dom.elements.board,pieces=s.pieces,curAnim=s.animation.current,anims=curAnim?curAnim.plan.anims:new Map,fadings=curAnim?curAnim.plan.fadings:new Map,curDrag=s.draggable.current,squares=computeSquareClasses(s),samePieces=new Set,sameSquares=new Set,movedPieces=new Map,movedSquares=new Map,k=void 0,el=void 0,pieceAtKey=void 0,elPieceName=void 0,anim=void 0,fading=void 0,pMvdset=void 0,pMvd=void 0,sMvdset=void 0,sMvd=void 0;for(el=boardEl.firstChild;el;){if(k=el.cgKey,isPieceNode(el))if(pieceAtKey=pieces.get(k),anim=anims.get(k),fading=fadings.get(k),elPieceName=el.cgPiece,!el.cgDragging||curDrag&&curDrag.orig===k||(el.classList.remove("dragging"),translate(el,posToTranslate(util_1.key2pos(k),asWhite)),el.cgDragging=!1),!fading&&el.cgFading&&(el.cgFading=!1,el.classList.remove("fading")),pieceAtKey){if(anim&&el.cgAnimating&&elPieceName===pieceNameOf(pieceAtKey)){var pos=util_1.key2pos(k);pos[0]+=anim[2],pos[1]+=anim[3],el.classList.add("anim"),translate(el,posToTranslate(pos,asWhite))}else el.cgAnimating&&(el.cgAnimating=!1,el.classList.remove("anim"),translate(el,posToTranslate(util_1.key2pos(k),asWhite)),s.addPieceZIndex&&(el.style.zIndex=posZIndex(util_1.key2pos(k),asWhite)));elPieceName!==pieceNameOf(pieceAtKey)||fading&&el.cgFading?fading&&elPieceName===pieceNameOf(fading)?(el.classList.add("fading"),el.cgFading=!0):appendValue(movedPieces,elPieceName,el):samePieces.add(k)}else appendValue(movedPieces,elPieceName,el);else if(isSquareNode(el)){var cn=el.className;squares.get(k)===cn?sameSquares.add(k):appendValue(movedSquares,cn,el)}el=el.nextSibling}var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=squares[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var _step$value=_slicedToArray(_step.value,2),sk=_step$value[0],className=_step$value[1];if(!sameSquares.has(sk)){sMvdset=movedSquares.get(className),sMvd=sMvdset&&sMvdset.pop();var translation=posToTranslate(util_1.key2pos(sk),asWhite);if(sMvd)sMvd.cgKey=sk,translate(sMvd,translation);else{var squareNode=util_1.createEl("square",className);squareNode.cgKey=sk,translate(squareNode,translation),boardEl.insertBefore(squareNode,boardEl.firstChild)}}}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}var _iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=pieces[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var _step2$value=_slicedToArray(_step2.value,2),_k=_step2$value[0],p=_step2$value[1];if(anim=anims.get(_k),!samePieces.has(_k))if(pMvdset=movedPieces.get(pieceNameOf(p)),pMvd=pMvdset&&pMvdset.pop()){pMvd.cgKey=_k,pMvd.cgFading&&(pMvd.classList.remove("fading"),pMvd.cgFading=!1);var _pos=util_1.key2pos(_k);s.addPieceZIndex&&(pMvd.style.zIndex=posZIndex(_pos,asWhite)),anim&&(pMvd.cgAnimating=!0,pMvd.classList.add("anim"),_pos[0]+=anim[2],_pos[1]+=anim[3]),translate(pMvd,posToTranslate(_pos,asWhite))}else{var pieceName=pieceNameOf(p),pieceNode=util_1.createEl("piece",pieceName),_pos2=util_1.key2pos(_k);pieceNode.cgPiece=pieceName,pieceNode.cgKey=_k,anim&&(pieceNode.cgAnimating=!0,_pos2[0]+=anim[2],_pos2[1]+=anim[3]),translate(pieceNode,posToTranslate(_pos2,asWhite)),s.addPieceZIndex&&(pieceNode.style.zIndex=posZIndex(_pos2,asWhite)),boardEl.appendChild(pieceNode)}}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2.return&&_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}var _iteratorNormalCompletion3=!0,_didIteratorError3=!1,_iteratorError3=void 0;try{for(var _step3,_iterator3=movedPieces.values()[Symbol.iterator]();!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=!0){removeNodes(s,_step3.value)}}catch(err){_didIteratorError3=!0,_iteratorError3=err}finally{try{!_iteratorNormalCompletion3&&_iterator3.return&&_iterator3.return()}finally{if(_didIteratorError3)throw _iteratorError3}}var _iteratorNormalCompletion4=!0,_didIteratorError4=!1,_iteratorError4=void 0;try{for(var _step4,_iterator4=movedSquares.values()[Symbol.iterator]();!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=!0){removeNodes(s,_step4.value)}}catch(err){_didIteratorError4=!0,_iteratorError4=err}finally{try{!_iteratorNormalCompletion4&&_iterator4.return&&_iterator4.return()}finally{if(_didIteratorError4)throw _iteratorError4}}}function updateBounds(s){if(!s.dom.relative)for(var asWhite=board_1.whitePov(s),posToTranslate=util.posToTranslateAbs(s.dom.bounds()),el=s.dom.elements.board.firstChild;el;)(isPieceNode(el)&&!el.cgAnimating||isSquareNode(el))&&util.translateAbs(el,posToTranslate(util_1.key2pos(el.cgKey),asWhite)),el=el.nextSibling}function isPieceNode(el){return"PIECE"===el.tagName}function isSquareNode(el){return"SQUARE"===el.tagName}function removeNodes(s,nodes){var _iteratorNormalCompletion5=!0,_didIteratorError5=!1,_iteratorError5=void 0;try{for(var _step5,_iterator5=nodes[Symbol.iterator]();!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=!0){var node=_step5.value;s.dom.elements.board.removeChild(node)}}catch(err){_didIteratorError5=!0,_iteratorError5=err}finally{try{!_iteratorNormalCompletion5&&_iterator5.return&&_iterator5.return()}finally{if(_didIteratorError5)throw _iteratorError5}}}function posZIndex(pos,asWhite){var z=2+8*pos[1]+(7-pos[0]);return asWhite&&(z=67-z),z+""}function pieceNameOf(piece){return piece.color+" "+piece.role}function computeSquareClasses(s){var _a,squares=new Map;if(s.lastMove&&s.highlight.lastMove){var _iteratorNormalCompletion6=!0,_didIteratorError6=!1,_iteratorError6=void 0;try{for(var _step6,_iterator6=s.lastMove[Symbol.iterator]();!(_iteratorNormalCompletion6=(_step6=_iterator6.next()).done);_iteratorNormalCompletion6=!0){addSquare(squares,_step6.value,"last-move")}}catch(err){_didIteratorError6=!0,_iteratorError6=err}finally{try{!_iteratorNormalCompletion6&&_iterator6.return&&_iterator6.return()}finally{if(_didIteratorError6)throw _iteratorError6}}}if(s.check&&s.highlight.check&&addSquare(squares,s.check,"check"),s.selected&&(addSquare(squares,s.selected,"selected"),s.movable.showDests)){var dests=null===(_a=s.movable.dests)||void 0===_a?void 0:_a.get(s.selected);if(dests){var _iteratorNormalCompletion7=!0,_didIteratorError7=!1,_iteratorError7=void 0;try{for(var _step7,_iterator7=dests[Symbol.iterator]();!(_iteratorNormalCompletion7=(_step7=_iterator7.next()).done);_iteratorNormalCompletion7=!0){var _k3=_step7.value;addSquare(squares,_k3,"move-dest"+(s.pieces.has(_k3)?" oc":""))}}catch(err){_didIteratorError7=!0,_iteratorError7=err}finally{try{!_iteratorNormalCompletion7&&_iterator7.return&&_iterator7.return()}finally{if(_didIteratorError7)throw _iteratorError7}}}var pDests=s.premovable.dests;if(pDests){var _iteratorNormalCompletion8=!0,_didIteratorError8=!1,_iteratorError8=void 0;try{for(var _step8,_iterator8=pDests[Symbol.iterator]();!(_iteratorNormalCompletion8=(_step8=_iterator8.next()).done);_iteratorNormalCompletion8=!0){var _k4=_step8.value;addSquare(squares,_k4,"premove-dest"+(s.pieces.has(_k4)?" oc":""))}}catch(err){_didIteratorError8=!0,_iteratorError8=err}finally{try{!_iteratorNormalCompletion8&&_iterator8.return&&_iterator8.return()}finally{if(_didIteratorError8)throw _iteratorError8}}}}var premove=s.premovable.current;if(premove){var _iteratorNormalCompletion9=!0,_didIteratorError9=!1,_iteratorError9=void 0;try{for(var _step9,_iterator9=premove[Symbol.iterator]();!(_iteratorNormalCompletion9=(_step9=_iterator9.next()).done);_iteratorNormalCompletion9=!0){addSquare(squares,_step9.value,"current-premove")}}catch(err){_didIteratorError9=!0,_iteratorError9=err}finally{try{!_iteratorNormalCompletion9&&_iterator9.return&&_iterator9.return()}finally{if(_didIteratorError9)throw _iteratorError9}}}else s.predroppable.current&&addSquare(squares,s.predroppable.current.key,"current-premove");var o=s.exploding;if(o){var _iteratorNormalCompletion10=!0,_didIteratorError10=!1,_iteratorError10=void 0;try{for(var _step10,_iterator10=o.keys[Symbol.iterator]();!(_iteratorNormalCompletion10=(_step10=_iterator10.next()).done);_iteratorNormalCompletion10=!0){addSquare(squares,_step10.value,"exploding"+o.stage)}}catch(err){_didIteratorError10=!0,_iteratorError10=err}finally{try{!_iteratorNormalCompletion10&&_iterator10.return&&_iterator10.return()}finally{if(_didIteratorError10)throw _iteratorError10}}}return squares}function addSquare(squares,key,klass){var classes=squares.get(key);classes?squares.set(key,classes+" "+klass):squares.set(key,klass)}function appendValue(map,key,value){var arr=map.get(key);arr?arr.push(value):map.set(key,[value])}var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{!_n&&_i.return&&_i.return()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr))return arr;if(Symbol.iterator in Object(arr))return sliceIterator(arr,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.updateBounds=exports.render=void 0;var util_1=__webpack_require__(0),board_1=__webpack_require__(1),util=__webpack_require__(0);exports.render=render,exports.updateBounds=updateBounds},function(module,exports,__webpack_require__){"use strict";function defaults(){return{pieces:fen.read(fen.initial),orientation:"white",turnColor:"white",coordinates:!0,autoCastle:!0,viewOnly:!1,disableContextMenu:!1,resizable:!0,addPieceZIndex:!1,pieceKey:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15}},pieces:{baseUrl:"images/pieces/icpieces/"},prevSvgHash:""},hold:util_1.timer()}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.defaults=void 0;var fen=__webpack_require__(3),util_1=__webpack_require__(0);exports.defaults=defaults},function(module,exports,__webpack_require__){"use strict";function renderWrap(element,s,relative){element.innerHTML="",element.classList.add("cg-wrap");var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=types_1.colors[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var c=_step.value;element.classList.toggle("orientation-"+c,s.orientation===c)}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}element.classList.toggle("manipulable",!s.viewOnly);var helper=util_1.createEl("cg-helper");element.appendChild(helper);var container=util_1.createEl("cg-container");helper.appendChild(container);var board=util_1.createEl("cg-board");container.appendChild(board);var svg=void 0;if(s.drawable.visible&&!relative&&(svg=svg_1.createElement("svg"),svg.appendChild(svg_1.createElement("defs")),container.appendChild(svg)),s.coordinates){var orientClass="black"===s.orientation?" black":"";container.appendChild(renderCoords(types_1.ranks,"ranks"+orientClass)),container.appendChild(renderCoords(types_1.files,"files"+orientClass))}var ghost=void 0;return s.draggable.showGhost&&!relative&&(ghost=util_1.createEl("piece","ghost"),util_1.setVisible(ghost,!1),container.appendChild(ghost)),{board:board,container:container,ghost:ghost,svg:svg}}function renderCoords(elems,className){var el=util_1.createEl("coords",className),f=void 0,_iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=elems[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var elem=_step2.value;f=util_1.createEl("coord"),f.textContent=elem,el.appendChild(f)}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2.return&&_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}return el}Object.defineProperty(exports,"__esModule",{value:!0}),exports.renderWrap=void 0;var util_1=__webpack_require__(0),types_1=__webpack_require__(4),svg_1=__webpack_require__(8);exports.renderWrap=renderWrap},function(module,__webpack_exports__,__webpack_require__){"use strict";function uniques(arr){return arr.filter(function(elem,index,self){return index===self.indexOf(elem)})}__webpack_exports__.a=uniques},function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0}),function(global){function install(Vue){Vue.component("echessboard",__WEBPACK_IMPORTED_MODULE_0__components_echessboard_index_vue___default.a)}__webpack_exports__.install=install;var __WEBPACK_IMPORTED_MODULE_0__components_echessboard_index_vue__=__webpack_require__(10),__WEBPACK_IMPORTED_MODULE_0__components_echessboard_index_vue___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0__components_echessboard_index_vue__);__webpack_require__.d(__webpack_exports__,"echessboard",function(){return __WEBPACK_IMPORTED_MODULE_0__components_echessboard_index_vue___default.a});var plugin={version:"0.0.16",install:install};__webpack_exports__.default=plugin;var GlobalVue=null;"undefined"!=typeof window?GlobalVue=window.Vue:void 0!==global&&(GlobalVue=global.Vue),GlobalVue&&GlobalVue.use(plugin)}.call(__webpack_exports__,__webpack_require__(9))},function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var __WEBPACK_IMPORTED_MODULE_0__jlincoln_echess_js__=__webpack_require__(11),__WEBPACK_IMPORTED_MODULE_0__jlincoln_echess_js___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0__jlincoln_echess_js__),__WEBPACK_IMPORTED_MODULE_1_echessground__=__webpack_require__(14),__WEBPACK_IMPORTED_MODULE_2__Util_js__=(__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_echessground__),__webpack_require__(21));__webpack_exports__.default={name:"echessboard",props:{fen:{type:String,default:""},free:{type:Boolean,default:!1},showThreats:{type:Boolean,default:!1},onPromotion:{type:Function,default:function(){return"q"}},orientation:{type:String,default:"white"}},watch:{fen:function(newFen){this.fen=newFen,this.loadPosition()},orientation:function(_orientation){this.orientation=_orientation,this.loadPosition()},showThreats:function(st){this.showThreats=st,this.showThreats&&this.paintThreats()}},methods:{possibleMoves:function(){var _this=this,dests={};return this.game.SQUARES.forEach(function(s){var ms=_this.game.moves({square:s,verbose:!0});ms.length&&(dests[s]=ms.map(function(m){return m.to}))}),new Map(Object.entries(dests))},opponentMoves:function(){var originalPGN=this.game.pgn(),tokens=this.game.fen().split(" ");if(tokens[1]="w"===tokens[1]?"b":"w",tokens=tokens.join(" "),this.game.load(tokens)){var moves=this.game.moves({verbose:!0});return this.game.load_pgn(originalPGN),moves}return[]},toColor:function(){return"w"===this.game.turn()?"white":"black"},paintThreats:function(){var moves=this.game.moves({verbose:!0}),threats=[];moves.forEach(function(move){threats.push({orig:move.to,brush:"yellow"}),move.captured&&threats.push({orig:move.from,dest:move.to,brush:"red"}),move.san.includes("+")&&threats.push({orig:move.from,dest:move.to,brush:"blue"})}),this.board.setShapes(threats)},calculatePromotions:function(){var moves=this.game.moves({verbose:!0});this.promotions=[];var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=moves[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var move=_step.value;move.promotion&&this.promotions.push(move)}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}},isPromotion:function(orig,dest){return this.promotions.filter(function(move){return move.from===orig&&move.to===dest}).length>0},changeTurn:function(){var _this2=this;return function(orig,dest,metadata){_this2.isPromotion(orig,dest)&&(_this2.promoteTo=_this2.onPromotion()),_this2.game.move({from:orig,to:dest,promotion:_this2.promoteTo}),_this2.board.set({fen:_this2.game.fen(),turnColor:_this2.toColor(),movable:{color:_this2.toColor(),dests:_this2.possibleMoves()}}),_this2.calculatePromotions(),_this2.afterMove()}},afterMove:function(){this.showThreats&&this.paintThreats();var threats=this.countThreats(this.toColor())||{};threats.history=this.game.history(),threats.fen=this.game.fen(),this.$emit("onMove",threats)},countThreats:function(color){var threats={},captures=0,checks=0,moves=this.game.moves({verbose:!0});return color!==this.toColor()&&(moves=this.opponentMoves()),0===moves.length?null:(moves.forEach(function(move){move.captured&&captures++,move.san.includes("+")&&checks++}),threats["legal_"+color]=__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_2__Util_js__.a)(moves.map(function(x){return x.from+x.to})).length,threats["checks_"+color]=checks,threats["threat_"+color]=captures,threats.turn=color,threats)},loadPosition:function(){this.game.load(this.fen),this.board=__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_1_echessground__.Echessground)(this.$refs.board,{fen:this.game.fen(),turnColor:this.toColor(),movable:{color:this.toColor(),free:this.free,dests:this.possibleMoves()},orientation:this.orientation}),this.board.set({movable:{events:{after:this.changeTurn()}}}),this.afterMove()}},mounted:function(){this.loadPosition()},created:function(){this.game=new __WEBPACK_IMPORTED_MODULE_0__jlincoln_echess_js___default.a(this.fen),this.board=null,this.promotions=[],this.promoteTo="q"}}},function(module,exports){module.exports=function(rawScriptExports,compiledTemplate,scopeId,cssModules){var esModule,scriptExports=rawScriptExports=rawScriptExports||{},type=typeof rawScriptExports.default;"object"!==type&&"function"!==type||(esModule=rawScriptExports,scriptExports=rawScriptExports.default);var options="function"==typeof scriptExports?scriptExports.options:scriptExports;if(compiledTemplate&&(options.render=compiledTemplate.render,options.staticRenderFns=compiledTemplate.staticRenderFns),scopeId&&(options._scopeId=scopeId),cssModules){var computed=options.computed||(options.computed={});Object.keys(cssModules).forEach(function(key){var module=cssModules[key];computed[key]=function(){return module}})}return{esModule:esModule,exports:scriptExports,options:options}}},function(module,exports){module.exports={render:function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{staticClass:"blue merida"},[_c("div",{ref:"board",staticClass:"cg-board-wrap"}),_vm._v(" "),_c("br")])},staticRenderFns:[]}}])});